# WebAssembly æŠ€æœ¯åˆ†äº«ç²¾ç®€æ€»ç»“

---

## ğŸ“š ç›®å½•

1. [æ¦‚è¿°ä¸èƒŒæ™¯](#ä¸€æ¦‚è¿°ä¸èƒŒæ™¯)
2. [æ ¸å¿ƒæ¦‚å¿µ](#äºŒæ ¸å¿ƒæ¦‚å¿µ)
3. [ä¸ºä»€ä¹ˆéœ€è¦WebAssembly](#ä¸‰ä¸ºä»€ä¹ˆéœ€è¦webassembly)
4. [å·¥ä½œåŸç†](#å››å·¥ä½œåŸç†)
5. [å®è·µå¼€å‘](#äº”å®è·µå¼€å‘)
6. [å®é™…åº”ç”¨æ¡ˆä¾‹](#å…­å®é™…åº”ç”¨æ¡ˆä¾‹)
7. [æœåŠ¡ç«¯åº”ç”¨](#ä¸ƒæœåŠ¡ç«¯åº”ç”¨)
8. [æ€»ç»“ä¸å»ºè®®](#å…«æ€»ç»“ä¸å»ºè®®)

---

## ä¸€ã€æ¦‚è¿°ä¸èƒŒæ™¯

### 1.1 ä»€ä¹ˆæ˜¯ WebAssembly

**WebAssemblyï¼ˆç®€ç§° Wasmï¼‰**æ˜¯ä¸€ç§å¯ä»¥åœ¨ç°ä»£ Web æµè§ˆå™¨ä¸­è¿è¡Œçš„ä»£ç ç±»å‹ã€‚å®ƒæ˜¯ä¸€ç§ä½çº§çš„ç±»æ±‡ç¼–è¯­è¨€ï¼Œå…·æœ‰ç´§å‡‘çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œèƒ½å¤Ÿä»¥æ¥è¿‘åŸç”Ÿçš„æ€§èƒ½è¿è¡Œã€‚

**æ ¸å¿ƒå®šä½**ï¼š
- **ä¸­é—´è¯­è¨€**ï¼šç±»ä¼¼ JVM å­—èŠ‚ç ã€LLVM IR
- **ç¼–è¯‘ç›®æ ‡**ï¼šå¤šç§è¯­è¨€å¯ä»¥ç¼–è¯‘ä¸º WebAssembly
- **æ‰§è¡Œç¯å¢ƒ**ï¼šæµè§ˆå™¨å’ŒåŸç”Ÿç¯å¢ƒéƒ½å¯ä»¥è¿è¡Œ
- **è®¾è®¡ç†å¿µ**ï¼šä¸ JavaScript äº’è¡¥ï¼Œè€Œéæ›¿ä»£

**é‡è¦ç†è§£**ï¼š
- WebAssembly **ä¸æ˜¯æ–°çš„ç¼–ç¨‹è¯­è¨€**ï¼Œæ²¡æœ‰äººæ‰‹å†™.wasmæ–‡ä»¶
- æ›´å€¾å‘äºæ˜¯ä¸€ä¸ª**ç¼–è¯‘é¢†åŸŸæ–°æŠ€æœ¯**
- å¹¶éåªèƒ½è¿è¡Œåœ¨æµè§ˆå™¨å†…ï¼Œè®¾è®¡è€…æœ‰æ›´è¿œå¤§çš„å®å›¾

### 1.2 å†å²æ¼”è¿›

#### ä» asm.js åˆ° WebAssembly

**2012å¹´ - Mozilla çš„å°è¯•**ï¼š
- Mozilla å·¥ç¨‹å¸ˆåœ¨ç ”ç©¶ LLVM æ—¶æå‡ºï¼šèƒ½å¦å°† C/C++ è½¬æ¢æˆ JavaScriptï¼Ÿ
- æˆç«‹ **Emscripten** é¡¹ç›®ï¼Œå°† C/C++ ç¼–è¯‘æˆ **asm.js**
- asm.js æ˜¯ JavaScript çš„ä¸¥æ ¼å­é›†ï¼Œé€šè¿‡ç‰¹æ®Šè¯­æ³•å®ç°æ€§èƒ½ä¼˜åŒ–

**Google Native Client çš„å¤±è´¥**ï¼š
- 2009å¹´ Google å‘å¸ƒ NaCl/PNaCl æ–¹æ¡ˆ
- 2017å¹´5æœˆ30æ—¥ Google å®£å¸ƒå¼ƒç”¨ NaCl
- **å¤±è´¥åŸå› **ï¼šåªæœ‰ Chrome æ”¯æŒï¼Œä¸å…·å¤‡è·¨æµè§ˆå™¨èƒ½åŠ›

**WebAssembly çš„è¯ç”Ÿ**ï¼š
- **2015å¹´**ï¼šWebAssembly é¡¹ç›®å¯åŠ¨
- **2017å¹´3æœˆ**ï¼šå››å¤§æµè§ˆå™¨å‚å•†å®£å¸ƒæ”¯æŒ
- **2019å¹´12æœˆ5æ—¥**ï¼šW3C æ­£å¼å‘å¸ƒ WebAssembly 1.0 è§„èŒƒï¼Œæˆä¸ºä¸ HTMLã€CSSã€JavaScript å¹¶åˆ—çš„ç¬¬å››ç±»ç¼–ç¨‹è¯­è¨€

### 1.3 æ ¸å¿ƒç‰¹ç‚¹

- âœ… **æ¥è¿‘åŸç”Ÿæ€§èƒ½**ï¼šè®¡ç®—å¯†é›†å‹ä»»åŠ¡å¯è¾¾åŸç”Ÿä»£ç çš„ 70-90%
- âœ… **å¤šè¯­è¨€æ”¯æŒ**ï¼šC/C++ã€Rustã€Goã€C#ã€TypeScriptï¼ˆAssemblyScriptï¼‰ç­‰
- âœ… **è·¨å¹³å°å…¼å®¹**ï¼šæµè§ˆå™¨ + åŸç”Ÿç¯å¢ƒï¼ˆwasmerã€wasmtimeï¼‰
- âœ… **å®‰å…¨æ²™ç›’**ï¼šå†…å­˜éš”ç¦»ï¼Œæ— æ³•è®¿é—®æœªåˆ†é…çš„å†…å­˜
- âœ… **Web æ ‡å‡†**ï¼šW3C æ­£å¼æ ‡å‡†ï¼Œæ‰€æœ‰ä¸»æµæµè§ˆå™¨æ”¯æŒ

---

## äºŒã€æ ¸å¿ƒæ¦‚å¿µ

### 2.1 Moduleï¼ˆæ¨¡å—ï¼‰

å·²ç¼–è¯‘çš„ WebAssembly äºŒè¿›åˆ¶ä»£ç ï¼Œæ— çŠ¶æ€ï¼Œå¯å…±äº«ã€‚

```javascript
const module = await WebAssembly.compileStreaming(fetch('module.wasm'));
```

### 2.2 Memoryï¼ˆå†…å­˜ï¼‰

å¯è°ƒæ•´å¤§å°çš„çº¿æ€§å­—èŠ‚æ•°ç»„ï¼ŒJavaScript å’Œ WebAssembly å¯ä»¥å…±äº«ã€‚

```javascript
const memory = new WebAssembly.Memory({ initial: 10 }); // 10é¡µ = 640KB
```

### 2.3 Tableï¼ˆè¡¨ï¼‰

å‡½æ•°å¼•ç”¨çš„æ•°ç»„ï¼Œç”¨äºå®ç°å‡½æ•°æŒ‡é’ˆã€‚ç”±äºå®‰å…¨åŸå› ï¼Œå‡½æ•°å¼•ç”¨ä¸èƒ½ç›´æ¥å­˜åœ¨å†…å­˜ä¸­ã€‚

```javascript
const table = new WebAssembly.Table({ initial: 2, element: "anyfunc" });
```

### 2.4 Instanceï¼ˆå®ä¾‹ï¼‰

Module + è¿è¡Œæ—¶çŠ¶æ€ï¼ˆMemoryã€Tableã€å¯¼å…¥å€¼ï¼‰ï¼Œå¯æ‰§è¡Œçš„å®é™…å¯¹è±¡ã€‚

```javascript
const { instance } = await WebAssembly.instantiateStreaming(
  fetch('module.wasm'),
  importObject
);
```

---

## ä¸‰ã€ä¸ºä»€ä¹ˆéœ€è¦ WebAssembly

### 3.1 æ€§èƒ½é—®é¢˜

#### JavaScript çš„å±€é™æ€§

1. **åŠ¨æ€ç±»å‹**ï¼šè¿è¡Œæ—¶ç±»å‹æ£€æŸ¥å¸¦æ¥æ€§èƒ½æŸå¤±
2. **è®¡ç®—å¯†é›†å‹æ“ä½œæ€§èƒ½ä¸è¶³**ï¼šå›¾åƒå¤„ç†ã€åŠ å¯†ã€ç§‘å­¦è®¡ç®—
3. **å¤§å‹åº”ç”¨è§£æå’Œç¼–è¯‘æˆæœ¬é«˜**

#### asm.js ä¸ºä»€ä¹ˆå¿«ï¼Ÿ

**æ ¸å¿ƒåŸå› **ï¼ˆwikiåŸæ–‡ï¼‰ï¼š
> Much of this performance gain over normal JavaScript is due to 100% type consistency and virtually no garbage collection.

**ç¿»è¯‘**ï¼š
> ä¸åŸç”ŸJavaScriptç›¸æ¯”ï¼Œæ€§èƒ½æå‡çš„ä¸»è¦åŸå› æ˜¯**100%çš„ç±»å‹ä¸€è‡´æ€§**ä»¥åŠ**å‡ ä¹æ²¡æœ‰(è‡ªåŠ¨çš„)åƒåœ¾å›æ”¶æœºåˆ¶**ã€‚

**å…³é”®ç‚¹**ï¼š
- å»æ‰å¤§éƒ¨åˆ†è‡ªåŠ¨GCæœºåˆ¶ï¼Œæ”¹ä¸ºæ‰‹åŠ¨å†…å­˜ç®¡ç†
- å¼ºç±»å‹è¯­è¨€ï¼Œç¼–è¯‘å™¨èƒ½æ›´å¤§ç¨‹åº¦ä¼˜åŒ–
- åªæ”¯æŒæµ®ç‚¹å’Œæ•´å½¢ï¼Œä¸æ”¯æŒå…¶ä»–ç±»å‹

**æ€§èƒ½è¡¨ç°**ï¼š
- èƒ½è¾¾åˆ°åŸç”ŸC/C++è¿è¡Œé€Ÿåº¦çš„**50%**
- æœ‰äº›åœºæ™¯ä¸‹ç”šè‡³èƒ½**æŒå¹³Clangç¼–è¯‘çš„C/C++ç”¨ä¾‹**

#### WebAssembly ä¸ºä»€ä¹ˆæ¯” asm.js å¿«ï¼Ÿ

1. **ä½“ç§¯æ›´å°**ï¼šæ¯”gzipå‹ç¼©åçš„JavaScriptä»£ç å°**10-20%**
2. **è§£ææ›´å¿«**ï¼šæ¯”JavaScriptå¿«**ä¸€ä¸ªæ•°é‡çº§**ï¼Œå¯å¹¶è¡Œè§£æ
3. **æ›´å¥½åˆ©ç”¨CPUç‰¹æ€§**ï¼šæ”¯æŒ64ä½æ•´æ•°ã€å„ç§CPUæŒ‡ä»¤ï¼Œå¹³å‡æ¯”asm.jsæé€Ÿ**5%**
4. **ç¼–è¯‘å·¥å…·é“¾ä¼˜åŒ–**ï¼šä½¿ç”¨Binaryenç¼–è¯‘å™¨ï¼Œé€Ÿåº¦æå‡**5-7%**

### 3.2 æ€§èƒ½å¯¹æ¯”çš„å®¢è§‚æ€§

**æ•´ä½“è¯„ä»·**ï¼š
> "å¾ˆå¿«ï¼Œä½†æ˜¯ä¸å¤Ÿå¿«" - æœŸæœ›å¿«10å€æˆ–8å€ï¼Œå®é™…ä¸Šåªèƒ½å¿«**ä¸åˆ°2å€å·¦å³**

#### æœ€å¤§æ€§èƒ½ï¼ˆç‰¹æ®Šç¼–å†™çš„JSï¼‰

**ç‰¹æ®Šç¼–å†™çš„åŸç”ŸJSå¯ä»¥ä¸Wasmå¤§è‡´æŒå¹³**ï¼š
- JSå¯ä»¥é€šè¿‡`ArrayBuffer`æ¨¡æ‹Ÿæˆ"memory managed language"
- é¿å…è‡ªåŠ¨GCå¼€é”€
- ä¼˜åŒ–æ•°æ®å±€éƒ¨æ€§(cache locality)
- åªä½¿ç”¨å¾ªç¯ã€å±€éƒ¨å˜é‡ã€ç®—æœ¯ã€å‡½æ•°è°ƒç”¨æ—¶ï¼ŒåŸç”ŸJSä¼šéå¸¸å¿«

**JSç›¸æ¯”Wasmçš„ä¼˜åŠ¿**ï¼š
- JSå¯ä»¥è®¿é—®**é›¶æ‹·è´(zero-copy)**çš„æ–¹æ³•ï¼ˆTextEncoderã€FileReader.readAsArrayBufferï¼‰
- Wasmè¿˜éœ€è¦é¢å¤–å†è¿›è¡Œä¸€æ¬¡å†…å­˜æ‹·è´

**Wasmç›¸æ¯”JSçš„ä¼˜åŠ¿**ï¼š
- **SIMDåŠ é€Ÿ**ï¼ˆSIMD.js APIå·²è¢«å¼ƒç”¨ï¼‰
- **å‰ç½®çš„ç¼–è¯‘ä¼˜åŒ–**

#### æ ‡å‡†æ€§èƒ½ï¼ˆæ­£å¸¸ä½¿ç”¨ç¼–ç¨‹è¯­è¨€ï¼‰

**å®é™…æƒ…å†µ**ï¼š
- ä»£ç çš„ç¼–å†™å¤æ‚åº¦å’Œå¯ç»´æŠ¤æ€§å¾ˆé‡è¦
- "å¥‡æŠ€æ·«å·§"ä¸é€‚åˆç”Ÿäº§å·¥ä½œ
- ä»£ç å·¥ç¨‹ä¼šä¾èµ–å¤§é‡ç¬¬ä¸‰æ–¹åº“ï¼ˆæ ‡å‡†JSç¼–å†™ï¼‰

**æµ‹è¯•ç»“æœ**ï¼ˆ2017å¹´Wasmè¯ç”Ÿä¹‹åˆï¼‰ï¼š
- 3Däººç‰©åŠ¨ç”»æµ‹è¯•ï¼šWasmæ¯”æ ‡å‡†JSå¿«äº†**8-15å€**
- éšç€JSçš„ä¸æ–­ä¼˜åŒ–ï¼Œç°åœ¨å·®å¼‚å¯èƒ½ä¸ä¼šè¿™ä¹ˆå¤§

**é‡è¦æé†’**ï¼š
> Wasmå¿«10%åˆ°1000%éƒ½æœ‰å¯èƒ½ï¼Œä¸åŒçš„æµ‹è¯•ç¯å¢ƒä¸‹ä¸å¯ä¸€æ¦‚è€Œè®ºã€‚

### 3.3 å…¼å®¹æ€§å’Œå®‰å…¨æ€§

- **å¤šè¯­è¨€æ”¯æŒ**ï¼šC/C++ã€Rustã€Goã€C#ã€TypeScriptç­‰
- **è·¨å¹³å°è¿è¡Œ**ï¼šæµè§ˆå™¨ + åŸç”Ÿç¯å¢ƒ
- **æ²™ç›’æ‰§è¡Œ**ï¼šå†…å­˜éš”ç¦»ï¼Œæ— æ³•è®¿é—®æœªåˆ†é…çš„å†…å­˜
- **ç±»å‹å®‰å…¨**ï¼šç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥

---

## å››ã€å·¥ä½œåŸç†

### 4.1 æ–‡æœ¬æ ¼å¼ï¼ˆWATï¼‰

WebAssembly æ–‡æœ¬æ ¼å¼ä½¿ç”¨ S-è¡¨è¾¾å¼ï¼š

```wat
(module
  (func $add (param $a i32) (param $b i32) (result i32)
    local.get $a
    local.get $b
    i32.add
  )
  (export "add" (func $add))
)
```

### 4.2 æ ˆæœºå™¨æ¨¡å‹

```wat
;; è®¡ç®— (a + b) * 2
local.get $a      ; æ ˆ: [a]
local.get $b      ; æ ˆ: [a, b]
i32.add           ; æ ˆ: [a+b]
i32.const 2       ; æ ˆ: [a+b, 2]
i32.mul           ; æ ˆ: [(a+b)*2]
```

### 4.3 æ•°æ®ç±»å‹

- **æ•°å­—ç±»å‹**ï¼ši32ã€i64ã€f32ã€f64
- **å‘é‡ç±»å‹**ï¼šv128ï¼ˆSIMDï¼‰
- **å¼•ç”¨ç±»å‹**ï¼šexternref

### 4.4 å†…å­˜æ¨¡å‹

- **çº¿æ€§å†…å­˜**ï¼šè¿ç»­å­—èŠ‚æ•°ç»„ï¼Œä»0å¼€å§‹çš„çº¿æ€§åœ°å€ç©ºé—´
- **é¡µå¼ç®¡ç†**ï¼šæ¯é¡µ64KB
- **è¾¹ç•Œæ£€æŸ¥**ï¼šè‡ªåŠ¨æ£€æŸ¥è¶Šç•Œè®¿é—®

---

## äº”ã€å®è·µå¼€å‘

### 5.1 å¼€å‘æ–¹å¼é€‰æ‹©

| æ–¹å¼ | é€‚åˆåœºæ™¯ | ä¼˜åŠ¿ | åŠ£åŠ¿ |
|------|---------|------|------|
| **WAT** | å­¦ä¹ ã€è°ƒè¯• | å®Œå…¨æ§åˆ¶ | æ•ˆç‡ä½ |
| **Emscripten** | C/C++ä»£ç å¤ç”¨ | æˆç†Ÿå·¥å…·é“¾ | ä»£ç ä½“ç§¯å¤§ |
| **Rust** | ç³»ç»Ÿçº§ã€é«˜æ€§èƒ½ | å†…å­˜å®‰å…¨ã€æ€§èƒ½ä¼˜ç§€ | å­¦ä¹ æ›²çº¿é™¡ |
| **AssemblyScript** | å‰ç«¯ã€å¿«é€Ÿå¼€å‘ | TypeScriptè¯­æ³• | åŠŸèƒ½å—é™ |

### 5.2 æ­£ç¡®ä½¿ç”¨ WebAssembly çš„æ­¥éª¤

1. **æ¢³ç†æ€§èƒ½ç“¶é¢ˆ**ï¼šæ‰¾å‡ºæœ‰æ€§èƒ½ç“¶é¢ˆçš„åœ°æ–¹ï¼ˆè§†é¢‘å¤„ç†ã€æ–‡ä»¶å¯¹æ¯”ã€æ¸¸æˆç­‰ï¼‰
2. **è¿›è¡Œdemoæ€§èƒ½æµ‹è¯•**ï¼šçœ‹æ˜¯å¦èƒ½è¾¾åˆ°é¢„æœŸçš„åŠ é€Ÿæ•ˆæœ
3. **ç¡®å®šæºè¯­è¨€**ï¼šC++/Rustä¼˜åŒ–ç¨‹åº¦æ›´é«˜ï¼ŒPHP/GO/JS/Pythonå¼€å‘æ•ˆç‡å¯èƒ½æ›´é‡è¦
4. **ç¼–ç å®ç°**ï¼šè®°å¾—å¤šæ‰“å¼€debugé€‰é¡¹
5. **ç¼–å†™JavaScriptèƒ¶æ°´ä»£ç **ï¼šåŠ è½½.wasmæ¨¡å—

### 5.3 å¿«é€Ÿä½“éªŒç¤ºä¾‹

åœ¨æµè§ˆå™¨Consoleä¸­è¿è¡Œï¼š

```javascript
WebAssembly.compile(new Uint8Array(`
  00 61 73 6d  01 00 00 00  01 0c 02 60  02 7f 7f 01
  7f 60 01 7f  01 7f 03 03  02 00 01 07  10 02 03 61
  64 64 00 00  06 73 71 75  61 72 65 00  01 0a 13 02
  08 00 20 00  20 01 6a 0f  0b 08 00 20  00 20 00 6c
  0f 0b`.trim().split(/[\s\r\n]+/g).map(str => parseInt(str, 16))
)).then(module => {
  const instance = new WebAssembly.Instance(module)
  const { add, square } = instance.exports
  console.log('2 + 4 =', add(2, 4))
  console.log('3^2 =', square(3))
})
```

---

## å…­ã€å®é™…åº”ç”¨æ¡ˆä¾‹

### 6.1 åº”ç”¨åœºæ™¯ç»Ÿè®¡ï¼ˆ2022å¹´ï¼‰

- **Webç«™ç‚¹å¼€å‘**ï¼šçº¦65%ï¼ˆæœ€å¤šï¼‰
- **Serverlesså’Œå®¹å™¨åŒ–**ï¼š35%ï¼ˆå¤§å¹…å¢é•¿ï¼Œå»å¹´20%ï¼‰
- **ä½œä¸ºæ’ä»¶ç¯å¢ƒ**ï¼šå¢é•¿å¹…åº¦æœ€å¤§ï¼ˆæ²™ç›’åŒ–å®‰å…¨ç¯å¢ƒï¼‰

### 6.2 Webç«¯åº”ç”¨æ¡ˆä¾‹

#### Google Earth 3Dåœ°å›¾
- ç”¨WebAssemblyä»£æ›¿äº†åŸæ¥çš„Native Client
- ç°åœ¨å¯ä»¥è¿è¡Œåœ¨Firefoxã€Edgeã€Operaæµè§ˆå™¨

#### Bilibiliè§†é¢‘ç½‘ç«™
- **Wasmç‰ˆFFmpeg**ï¼šè§†é¢‘ç¼–è§£ç 
- **Wasmç‰ˆTensorflow**ï¼šAIæ™ºèƒ½ç”Ÿæˆå°é¢

#### Figmaåœ¨çº¿UIè®¾è®¡
- 2018å¹´ä¼°å€¼1äº¿ç¾å…ƒ â†’ 2021å¹´100äº¿ç¾å…ƒï¼ˆæš´æ¶¨100å€ï¼‰
- ä½¿ç”¨zaplibï¼ˆåŸºäºwasmå’ŒRustçš„é«˜æ€§èƒ½webåº”ç”¨æ¡†æ¶ï¼‰
- å¤–å›´äº¤äº’ï¼šåŸç”ŸJS+CSS+HTML
- æ ¸å¿ƒç»˜å›¾åŒºåŸŸï¼šwasm+webGLé©±åŠ¨çš„canvasæ¨¡å—

#### Adobe Photoshop Webç‰ˆ
- ä½¿ç”¨Emscriptenå°†å®Œæ•´C++å·¥ç¨‹ç§»æ¤åˆ°webç«¯
- webç«¯å’ŒPCç«¯åº”ç”¨å¯ä»¥ç”±åŒä¸€ä»½æºç ç¼–è¯‘ç”Ÿæˆ
- Emscriptenæä¾›è½¬æ¢å±‚ï¼ˆPOSIX API â†’ Web APIï¼ŒOpenGL â†’ WebGLï¼‰

#### Zoom Webç‰ˆåœ¨çº¿ä¼šè®®
- **WebAssembly SIMD**ï¼šè§†é¢‘æµå¤„ç†ã€è‡ªåŠ¨å­—å¹•ã€è™šæ‹ŸèƒŒæ™¯

#### TensorFlow.js
- WebAssemblyåŠ é€Ÿåç«¯
- é€šè¿‡XNNPACKåˆ©ç”¨SIMDæŒ‡ä»¤å’Œå¤šçº¿ç¨‹
- é€Ÿåº¦æé«˜äº†**10å€**
- SIMDï¼š1.7-4.5å€æ€§èƒ½æå‡
- å¤šçº¿ç¨‹ï¼šåœ¨æ­¤åŸºç¡€ä¸Šåˆå¸¦æ¥1.8-2.9å€åŠ é€Ÿ

#### FFmpeg.wasm
- ä¸å†å®Œå…¨ä¾èµ–æµè§ˆå™¨çš„éŸ³è§†é¢‘èƒ½åŠ›
- æ”¯æŒå‡ ä¹æ‰€æœ‰æ ¼å¼çš„éŸ³è§†é¢‘å¤„ç†
- **é™åˆ¶**ï¼šæµè§ˆå™¨å†…çš„ffmpeg.wasmåªèƒ½çº¯CPUè½¯è§£

#### Unity/Unrealæ¸¸æˆå¼•æ“
- Unityï¼šæ‰€æœ‰ç‰ˆæœ¬éƒ½æ”¯æŒå‘å¸ƒåˆ°webç«¯ï¼ˆå¹³å°å"webGL"ï¼‰
- Unrealï¼š4.18ä¹‹å‰ç‰ˆæœ¬æ”¯æŒï¼ˆHTML5å¹³å°ï¼‰
- **UEåç»­ç‰ˆæœ¬**ï¼šä¸å†æ”¯æŒwebç«¯ï¼ˆå®˜æ–¹è¯´æ³•ï¼šæœªè¾¾åˆ°é¢„æœŸæ•ˆæœä¸”ä¸å¥½ç»´æŠ¤ï¼‰

---

## ä¸ƒã€æœåŠ¡ç«¯åº”ç”¨

### 7.1 Dockeråˆ›å§‹äººçš„è§‚ç‚¹

**Solomon Hykes (2019å¹´3æœˆTwitter)**ï¼š
> å¦‚æœ2008å¹´çš„æ—¶å€™ï¼ŒWASMå’ŒWASIå·²ç»å­˜åœ¨çš„è¯ï¼Œæˆ‘ä»¬å°±æ²¡æœ‰å¿…è¦åˆ›ç«‹Dockeräº†ã€‚åœ¨æœåŠ¡å™¨ä¸Šè¿è¡ŒWebAssemblyæ˜¯è®¡ç®—çš„æœªæ¥ã€‚

### 7.2 WASIï¼šè§£å†³è·¨å¹³å°è¿è¡Œ

**é—®é¢˜**ï¼š
- WebAssemblyè„±ç¦»æµè§ˆå™¨åï¼Œéœ€è¦æŠ¹å¹³ç³»ç»ŸAPIçš„å·®å¼‚æ€§

**WASIçš„ä½œç”¨**ï¼š
- **WebAssembly System Interface**ï¼ˆWebAssemblyç³»ç»Ÿæ¥å£ï¼‰
- è§£å†³æ–‡ä»¶æ“ä½œã€ç½‘ç»œè¿æ¥ã€ç³»ç»Ÿæ—¶é’Ÿã€éšæœºæ•°ç­‰æ“ä½œç³»ç»Ÿè°ƒç”¨çš„è·¨å¹³å°é—®é¢˜
- ç›®æ ‡ï¼šä¸€ä»½wasmä»£ç è¿è¡Œåœ¨æ‰€æœ‰ä¸åŒç¯å¢ƒä¸åŒæ“ä½œç³»ç»Ÿçš„æœºå™¨ä¸­

**è·¨å¹³å°å¯¹æ¯”**ï¼š

**Cè¯­è¨€ï¼ˆæºç çº§è·¨å¹³å°ï¼‰**ï¼š
```
Cæºç  â†’ clangç¼–è¯‘3æ¬¡ â†’ 3ä»½ä¸åŒå¹³å°çš„æœºå™¨ç 
```

**WebAssemblyï¼ˆäºŒè¿›åˆ¶çº§è·¨å¹³å°ï¼‰**ï¼š
```
Cæºç  â†’ ç¼–è¯‘1æ¬¡ â†’ .wasm â†’ WebAssembly runtime â†’ ä¸åŒæ“ä½œç³»ç»Ÿ
```

**ç±»æ¯”**ï¼š
- WebAssembly runtime â†” JVM
- .wasm â†” Java bytecode
- **ä¸åŒ**ï¼šWebAssemblyæ”¯æŒæ›´å¤šè¯­è¨€ï¼Œè¿è¡Œåœ¨æµè§ˆå™¨é‡Œæ”¯æŒæ›´å®Œå¤‡

### 7.3 WASIç°åœ¨çš„è¿›å±•

- **Wasmtime**ï¼šBytecode Allianceä½¿ç”¨Rustå¼€å‘ï¼ˆ11.3K+ starï¼‰
- **Wasmtime 1.0ï¼ˆ2022å¹´9æœˆï¼‰**ï¼šå¿«ï¼å®‰å…¨ï¼èƒ½å¤Ÿç”¨äºç”Ÿäº§ç¯å¢ƒï¼

### 7.4 æœåŠ¡ç«¯åº”ç”¨åœºæ™¯

**å®¹å™¨è™šæ‹ŸåŒ–çš„ä¸‰ä¸ªæŠ½è±¡å±‚**ï¼š
1. Hypervisor VMï¼ˆmicroVMsï¼‰- AWS Firecrackerã€VMware
2. Application containers - Dockerï¼ˆæ¯”è¾ƒ"é‡"ï¼‰
3. High level language VMs - JVMã€Python runtimesã€**WebAssembly**

**å®˜æ–¹æ¨èçš„äº”ä¸ªåœºæ™¯**ï¼š

1. **å¾®æœåŠ¡/æ— æœåŠ¡å¹³å°**
   - å¯åŠ¨æ—¶é—´ï¼šWebAssemblyå®ä¾‹åªéœ€è¦**5å¾®ç§’**
   - è½»é‡çº§ï¼šä¸€å°æœºå™¨å¯ä»¥æ­è½½æ›´å¤šå®ä¾‹

2. **ç¬¬ä¸‰æ–¹æ’ä»¶ç³»ç»Ÿ**
   - æ²™ç›’åŒ–å®‰å…¨ç¯å¢ƒ
   - ç¬¬ä¸‰æ–¹ç¨‹åºæ— æ³•è®¿é—®æœªæ˜ç¡®äº¤ç»™å®ƒçš„ç³»ç»Ÿèµ„æº

3. **æ•°æ®åº“UDFåŠŸèƒ½**
   - æ”¯æŒæ›´å¤šè¯­è¨€ã€å®‰å…¨éš”ç¦»ã€è·¨å¹³å°ã€æ€§èƒ½å¥½ã€å†·å¯åŠ¨å¿«
   - æ¡ˆä¾‹ï¼šGoogle BigQueryã€é˜¿é‡Œäº‘MaxCompute

4. **å¯ä¿¡æ‰§è¡Œç¯å¢ƒï¼ˆTEEï¼‰**
   - ç§»åŠ¨æ”¯ä»˜ã€éšç§è®¡ç®—
   - æ”¯æŒæ›´å¤šè¯­è¨€ã€æ”¯æŒå¤§å¤šæ•°ä¸»æµCPUæ¶æ„

5. **å¼€å‘å¯ç§»æ¤çš„åº”ç”¨ç¨‹åº**
   - è·¨å¹³å°runtimeï¼Œè¿è¡Œåœ¨ä¸åŒCPUæ¶æ„ã€ä¸åŒæ“ä½œç³»ç»Ÿ

---

## å…«ã€æ€»ç»“ä¸å»ºè®®

### 8.1 ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šä½ çš„Webåº”ç”¨æ€§èƒ½ç“¶é¢ˆåœ¨å“ªé‡Œï¼Ÿ

**é‡è¦æé†’**ï¼š
> å…ˆæƒ³æ¸…æ¥šè¿™ä¸ªé—®é¢˜å†åšä¼˜åŒ–

**Figmaçš„ä¾‹å­**ï¼š
- ä½¿ç”¨wasmå°†åº”ç”¨ç§»æ¤åˆ°webç«¯ï¼Œè¿›è¡Œäº†å¤§é‡æ€§èƒ½ä¼˜åŒ–
- **ä½†æœ€åå¤ç›˜å‘ç°æ€§èƒ½æå‡çš„çœŸæ­£æ¥æºå…¶å®æ˜¯webGLæ¸²æŸ“å™¨çš„æ”¹è¿›**
- ä¹Ÿå°±æ˜¯GPUç¡¬ä»¶åŠ é€Ÿçš„æ”¶ç›Šï¼Œè·ŸWebAssemblyæ²¡æœ‰å…³ç³»

**å…³é”®ç‚¹**ï¼š
- Wasmè§£å†³çš„æ˜¯**Webç«¯CPUè®¡ç®—å¯†é›†**çš„æ€§èƒ½é—®é¢˜
- æ€§èƒ½ç“¶é¢ˆå¯èƒ½å‹æ ¹å°±ä¸åœ¨CPUè®¡ç®—ä¸Š

### 8.2 ç¬¬äºŒä¸ªé—®é¢˜ï¼šWebAssemblyåˆ°åº•ç®—æˆåŠŸäº†å—ï¼Ÿ

**ä»æŠ€æœ¯æˆç†Ÿåº¦**ï¼š
> âœ… **æˆåŠŸçš„** - WebAssemblyå·²ç»æŠ•å…¥åˆ°äº†å¤§é‡çš„ç”Ÿäº§åº”ç”¨ä¸­

**ä»æ¨å¹¿åº”ç”¨**ï¼š
> âŒ **ç›®å‰æ˜¯ä¸æˆåŠŸçš„** - å› ä¸º90%ä»¥ä¸Šçš„åœºæ™¯å…¶å®ä¸éœ€è¦WebAssembly

**ä»æ€§èƒ½è§’åº¦**ï¼š
> WebAssemblyå¾ˆå¿«ï¼Œä½†æ˜¯è¿˜ä¸å¤Ÿå¿«ï¼Œä¸è¶³ä»¥è®©å¼€å‘è€…å®Œå…¨è½¬å‘æ‹¥æŠ±ä¸€ä¸ªå´­æ–°çš„æŠ€æœ¯

### 8.3 ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬å¦‚ä½•æ‹¥æŠ±WebAssemblyè¿™ä¸ªæ–°æŠ€æœ¯ï¼Ÿ

**æœ‰åº”ç”¨ä»·å€¼çš„3ä¸ªåœ°æ–¹**ï¼š

1. **PCç«¯åº”ç”¨ç§»æ¤åˆ°webç«¯**
   - æ— éœ€äºŒæ¬¡å¼€å‘
   - ä¿æŒå¤šç«¯ä»£ç ä¸€è‡´æ€§

2. **éŸ³è§†é¢‘å¤„ç†è¿™äº›é«˜æ€§èƒ½åº”ç”¨**
   - åˆ‡æ¢åˆ°WebAssemblyç¡®å®èƒ½å¸¦æ¥å¾ˆå¤§çš„æ€§èƒ½æå‡

3. **åç«¯å¾®æœåŠ¡/æ— æœåŠ¡**
   - å¯ä»¥å®ç°æ”¯æŒå¤šè¯­è¨€çš„äº‘å‡½æ•°ä¹‹ç±»çš„å¹³å°

### 8.4 æœ€ç»ˆæ€»ç»“

**æ ¸å¿ƒè§‚ç‚¹**ï¼š
> WebAssemblyå¹¶ä¸æ˜¯ä»€ä¹ˆç¥å¥‡çš„æŠ€æœ¯ï¼Œæ›´åƒæ˜¯å½“å¹´JVMæœªå®Œæˆç†æƒ³çš„å¼€æºplusç‰ˆæœ¬

**å¯¹å¼€å‘è€…çš„å»ºè®®**ï¼š
- æ²¡å¿…è¦è·Ÿé£è¿½æ§æˆ–è€…è¯‹æ¯
- ä¸åŒçš„æµ‹è¯•ç”¨ä¾‹ã€ç¡¬ä»¶ç¯å¢ƒã€ç¼–è¯‘å™¨ä¼˜åŒ–ç¨‹åº¦ã€æµè§ˆå™¨å¼•æ“ä¼˜åŒ–ç¨‹åº¦éƒ½ä¼šå¯¹Wasmçš„è¿è¡Œäº§ç”Ÿå½±å“
- **ä¸åœ¨å…·ä½“åœºæ™¯ä¸‹ç©ºè°ˆæ€§èƒ½éƒ½æ˜¯æ²¡æœ‰æ„ä¹‰çš„**
- æ ¹æ®è‡ªå·±çš„åº”ç”¨åœºæ™¯ + æ€§èƒ½æµ‹è¯•ç»“æœ + æ”¹é€ å·¥ä½œé‡ç»¼åˆè¯„ä¼°æ˜¯å¦ä½¿ç”¨å³å¯

### 8.5 æ€§èƒ½å¯¹æ¯”æ€»ç»“

**æ€§èƒ½æ’åº**ï¼š
```
åŸç”ŸC/C++ä»£ç  > WebAssembly > asm.js > åŸç”ŸJavaScript
```

**å®é™…æ€§èƒ½æå‡**ï¼š
- æœŸæœ›ï¼šå¿«10å€æˆ–8å€
- å®é™…ï¼š**ä¸åˆ°2å€å·¦å³**
- ä¸åŒåœºæ™¯ï¼šå¿«10%åˆ°1000%éƒ½æœ‰å¯èƒ½

**å…³é”®å› ç´ **ï¼š
- ä»»åŠ¡ç±»å‹ï¼ˆè®¡ç®—å¯†é›†å‹ vs I/Oå¯†é›†å‹ï¼‰
- æµè§ˆå™¨å®ç°
- ç¡¬ä»¶ç¯å¢ƒ
- ä»£ç ä¼˜åŒ–ç¨‹åº¦

### 8.6 é€‚ç”¨åœºæ™¯

**é€‚åˆä½¿ç”¨**ï¼š
- âœ… è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼ˆå›¾åƒå¤„ç†ã€åŠ å¯†ã€ç§‘å­¦è®¡ç®—ï¼‰
- âœ… PCç«¯åº”ç”¨ç§»æ¤åˆ°webç«¯
- âœ… éŸ³è§†é¢‘å¤„ç†
- âœ… åç«¯å¾®æœåŠ¡/æ— æœåŠ¡å¹³å°
- âœ… éœ€è¦å¤ç”¨ç°æœ‰C/C++/Rustä»£ç 

**ä¸é€‚åˆä½¿ç”¨**ï¼š
- âŒ ç®€å•çš„DOMæ“ä½œ
- âŒ å¿«é€ŸåŸå‹å¼€å‘
- âŒ 90%ä»¥ä¸Šçš„æ™®é€šwebåº”ç”¨åœºæ™¯

---

## ğŸ“Š æ¼”ç¤ºä»£ç æ¸…å•

### å·²å®ç°çš„ç¤ºä¾‹

1. **01-hello-world** - Hello World ç¤ºä¾‹
2. **02-memory** - å†…å­˜æ“ä½œç¤ºä¾‹
3. **03-performance** - æ€§èƒ½å¯¹æ¯”ç¤ºä¾‹
4. **04-calculator** - å®Œæ•´åº”ç”¨ç¤ºä¾‹ï¼ˆè®¡ç®—å™¨ï¼‰
5. **05-table** - Table ä½¿ç”¨ç¤ºä¾‹
6. **06-javascript-api** - JavaScript API ç¤ºä¾‹
7. **07-rust** - Rust è½¬ WebAssembly ç¤ºä¾‹
8. **08-assemblyscript** - AssemblyScript è½¬ WebAssembly ç¤ºä¾‹
9. **09-javascript-builtins** - JavaScript Builtins ç¤ºä¾‹
10. **10-wasi** - WASI ç¤ºä¾‹
11. **11-hash** - å¤§æ–‡ä»¶Hashæ€§èƒ½å¯¹æ¯”ï¼ˆRustï¼‰
12. **12-image-processing** - å›¾ç‰‡ç°åº¦å¤„ç†æ€§èƒ½å¯¹æ¯”
13. **13-sorting** - å¤æ‚æ’åºæ€§èƒ½å¯¹æ¯”ï¼ˆ100ä¸‡æ•°æ®ï¼‰

---

## ğŸ”— å‚è€ƒèµ„æº

### å®˜æ–¹èµ„æº
- [webassembly.org](https://webassembly.org/)
- [WebAssembly è§„èŒƒ](https://webassembly.github.io/spec/)
- [W3C WebAssemblyå·¥ä½œç»„](https://www.w3.org/groups/wg/wasm/)

### å­¦ä¹ èµ„æº
- [MDN WebAssemblyæ–‡æ¡£](https://developer.mozilla.org/en-US/docs/WebAssembly)
- [WASMæ±‡ç¼–å…¥é—¨æ•™ç¨‹](https://evian-zhang.github.io/wasm-tutorial/)
- [çŸ¥ä¹æ–‡ç« ï¼šWebAssemblyåŸç†å‰–æä¸ç”Ÿäº§åº”ç”¨](https://zhuanlan.zhihu.com/p/620767652)

### å·¥å…·èµ„æº
- [Emscripten](https://emscripten.org/) - C/C++ åˆ° WebAssembly
- [wasm-pack](https://rustwasm.github.io/wasm-pack/) - Rust åˆ° WebAssembly
- [AssemblyScript](https://www.assemblyscript.org/) - TypeScript åˆ° WebAssembly
- [wabt](https://github.com/WebAssembly/wabt) - WebAssembly äºŒè¿›åˆ¶å·¥å…·åŒ…
- [wasmer](https://wasmer.io/) - WebAssembly è¿è¡Œæ—¶
- [wasmtime](https://wasmtime.dev/) - WebAssembly è¿è¡Œæ—¶

---
