<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rust è½¬ WebAssembly ç¤ºä¾‹</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
            color: #222;
            font-size: 16px;
            line-height: 1.6;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1a1a1a;
            border-bottom: 3px solid #ce412b;
            padding-bottom: 10px;
            font-size: 28px;
            font-weight: bold;
        }
        h2 {
            color: #2a2a2a;
            font-size: 20px;
            font-weight: 600;
            margin-top: 30px;
        }
        .demo-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 5px;
        }
        button {
            background: #ce412b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #a83222;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #e8f4f8;
            border-left: 4px solid #ce412b;
            font-family: 'Courier New', monospace;
            color: #1a1a1a;
            font-size: 15px;
            font-weight: 500;
        }
        input {
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 4px;
            margin: 5px;
            font-size: 15px;
            color: white;
            background-color: #333;
        }
        input::placeholder {
            color: #aaa;
        }
        .info-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            color: #856404;
        }
        .info-box strong {
            color: #664d03;
            font-size: 16px;
        }
        code {
            background: #f4f4f4;
            padding: 3px 8px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #c7254e;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¦€ Rust è½¬ WebAssembly ç¤ºä¾‹</h1>
        <p>å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Rust ç¼–å†™ä»£ç å¹¶ç¼–è¯‘ä¸º WebAssembly</p>
        
        <div class="info-box">
            <strong>Rust çš„ä¼˜åŠ¿ï¼š</strong>
            <ul>
                <li>å†…å­˜å®‰å…¨ï¼šç¼–è¯‘æ—¶ä¿è¯å†…å­˜å®‰å…¨</li>
                <li>é›¶æˆæœ¬æŠ½è±¡ï¼šé«˜æ€§èƒ½</li>
                <li>ä¸°å¯Œçš„å·¥å…·é“¾ï¼šwasm-packã€wasm-bindgen</li>
                <li>ç±»å‹å®‰å…¨ï¼šå¼ºç±»å‹ç³»ç»Ÿ</li>
            </ul>
        </div>
        
        <div class="demo-section">
            <h2>1. åŸºæœ¬è¿ç®—</h2>
            <p>è®¡ç®— <input type="number" id="addA" value="10"> + <input type="number" id="addB" value="20"></p>
            <button onclick="demoAdd()">è®¡ç®—</button>
            <div id="addResult" class="result" style="display:none;"></div>
        </div>
        
        <div class="demo-section">
            <h2>2. æ–æ³¢é‚£å¥‘æ•°åˆ—</h2>
            <p>è®¡ç®—ç¬¬ <input type="number" id="fibN" value="40" min="1" max="50"> ä¸ªæ–æ³¢é‚£å¥‘æ•°</p>
            <button onclick="demoFibonacci()">è®¡ç®—</button>
            <div id="fibResult" class="result" style="display:none;"></div>
        </div>
        
        <div class="demo-section">
            <h2>3. é˜¶ä¹˜</h2>
            <p>è®¡ç®— <input type="number" id="factN" value="12" min="1" max="20"> çš„é˜¶ä¹˜</p>
            <button onclick="demoFactorial()">è®¡ç®—</button>
            <div id="factResult" class="result" style="display:none;"></div>
        </div>
        
        <div class="demo-section">
            <h2>4. å­—ç¬¦ä¸²å¤„ç†</h2>
            <p>è¾“å…¥åå­—ï¼š<input type="text" id="nameInput" value="WebAssembly" placeholder="è¾“å…¥åå­—"></p>
            <button onclick="demoGreet()">æ‰“æ‹›å‘¼</button>
            <div id="greetResult" class="result" style="display:none;"></div>
        </div>
        
        <div class="demo-section">
            <h2>5. æ•°ç»„æ±‚å’Œ</h2>
            <p>å¯¹æ•°ç»„ [1, 2, 3, 4, 5, 10, 20, 30] æ±‚å’Œ</p>
            <button onclick="demoSumArray()">è®¡ç®—</button>
            <div id="sumResult" class="result" style="display:none;"></div>
        </div>
        
        <div class="demo-section">
            <h2>6. å†…å­˜æ“ä½œï¼ˆç»“æ„ä½“ï¼‰</h2>
            <p>æ¼”ç¤º Rust ç»“æ„ä½“åœ¨ WebAssembly ä¸­çš„ä½¿ç”¨</p>
            <button onclick="demoMemory()">æ¼”ç¤º</button>
            <div id="memoryResult" class="result" style="display:none;"></div>
        </div>
    </div>

    <script type="module">
        import init, { add, fibonacci, factorial, greet, sum_array, MemoryDemo } from './pkg/rust_wasm_example.js';

        let wasmReady = false;

        async function initWasm() {
            if (wasmReady) return;
            try {
                await init();
                wasmReady = true;
                console.log('Rust WebAssembly æ¨¡å—åŠ è½½æˆåŠŸï¼');
            } catch (error) {
                console.error('åŠ è½½å¤±è´¥:', error);
                alert('åŠ è½½ WebAssembly å¤±è´¥ã€‚è¯·ç¡®ä¿å·²ç¼–è¯‘ Rust ä»£ç ã€‚\n\nè¿è¡Œ: wasm-pack build --target web');
                throw error;
            }
        }

        window.demoAdd = async function() {
            await initWasm();
            const a = parseInt(document.getElementById('addA').value);
            const b = parseInt(document.getElementById('addB').value);
            const result = add(a, b);
            document.getElementById('addResult').style.display = 'block';
            document.getElementById('addResult').textContent = `${a} + ${b} = ${result}`;
        };

        window.demoFibonacci = async function() {
            await initWasm();
            const n = parseInt(document.getElementById('fibN').value);
            const start = performance.now();
            const result = fibonacci(n);
            const time = performance.now() - start;
            document.getElementById('fibResult').style.display = 'block';
            document.getElementById('fibResult').textContent = `ç¬¬ ${n} ä¸ªæ–æ³¢é‚£å¥‘æ•°: ${result}\nè®¡ç®—æ—¶é—´: ${time.toFixed(2)} ms`;
        };

        window.demoFactorial = async function() {
            await initWasm();
            const n = parseInt(document.getElementById('factN').value);
            const start = performance.now();
            const result = factorial(n);
            const time = performance.now() - start;
            document.getElementById('factResult').style.display = 'block';
            document.getElementById('factResult').textContent = `${n}! = ${result}\nè®¡ç®—æ—¶é—´: ${time.toFixed(2)} ms`;
        };

        window.demoGreet = async function() {
            await initWasm();
            const name = document.getElementById('nameInput').value || 'World';
            const result = greet(name);
            document.getElementById('greetResult').style.display = 'block';
            document.getElementById('greetResult').textContent = result;
        };

        window.demoSumArray = async function() {
            await initWasm();
            const arr = [1, 2, 3, 4, 5, 10, 20, 30];
            const result = sum_array(arr);
            document.getElementById('sumResult').style.display = 'block';
            document.getElementById('sumResult').textContent = `æ•°ç»„: [${arr.join(', ')}]\næ±‚å’Œç»“æœ: ${result}`;
        };

        window.demoMemory = async function() {
            await initWasm();
            const demo = new MemoryDemo();
            const data = demo.get_data();
            demo.add_item(100);
            const sum = demo.sum();
            document.getElementById('memoryResult').style.display = 'block';
            document.getElementById('memoryResult').textContent = 
                `åˆå§‹æ•°æ®: [${data.join(', ')}]\næ·»åŠ  100 åæ±‚å’Œ: ${sum}`;
        };
    </script>
</body>
</html>

