# Demo 2: 图片灰度处理性能对比

> JavaScript Canvas vs WebAssembly - 图像处理性能测试

## 📖 简介

本演示对比 JavaScript Canvas API 和 WebAssembly 在图片灰度处理中的性能差异。

## 🎯 功能特点

- **灰度算法**：Gray = 0.299*R + 0.587*G + 0.114*B（标准灰度转换公式）
- **测试方式**：上传图片，分别使用 JS Canvas 和 Wasm 处理
- **性能指标**：执行时间、处理速度（像素/秒）
- **实时预览**：显示原始图片和处理后的结果

## 🔧 编译步骤

```bash
cd src/12-image-processing
wat2wasm grayscale.wat -o grayscale.wasm
```

## 🌐 运行示例

1. 启动本地 HTTP 服务器：
   ```bash
   python3 -m http.server 8000
   ```

2. 在浏览器中打开：
   ```
   http://localhost:8000/12-image-processing/
   ```

3. 选择图片文件并点击"处理图片"

## 📊 性能对比

### 测试结果示例

**1920×1080 图片（约 200 万像素）**：
- JavaScript: ~30-50 ms
- WebAssembly: ~10-20 ms
- **性能提升**: 2-3x

**4K 图片（3840×2160，约 800 万像素）**：
- JavaScript: ~120-200 ms
- WebAssembly: ~40-80 ms
- **性能提升**: 2-3x

### 性能分析

1. **WebAssembly 优势**：
   - 直接内存操作，无 API 开销
   - 编译优化，执行效率高
   - 批量处理，减少函数调用

2. **JavaScript Canvas 特点**：
   - ImageData API 有额外开销
   - 动态类型检查
   - 内存访问间接

## 📁 文件说明

- `grayscale.wat` - WebAssembly 文本格式源代码
- `grayscale.wasm` - 编译后的二进制文件
- `index.html` - 演示页面
- `README.md` - 本说明文档

## 🔍 灰度算法说明

### 标准灰度转换公式

```
Gray = 0.299*R + 0.587*G + 0.114*B
```

**系数说明**：
- R: 0.299（人眼对红色敏感度）
- G: 0.587（人眼对绿色敏感度最高）
- B: 0.114（人眼对蓝色敏感度最低）

**WebAssembly 实现**：
- 使用整数运算避免浮点数开销
- Gray = (299*R + 587*G + 114*B) / 1000
- 或使用快速版本：Gray = (R*77 + G*150 + B*29) >> 8

## 💡 使用场景

1. **图像处理应用**：在线图片编辑器
2. **批量处理**：大量图片的灰度转换
3. **实时处理**：视频流的实时灰度处理
4. **性能优化**：需要高性能图像处理的场景

## 🚀 扩展建议

1. **更多图像滤镜**：
   - 亮度调整
   - 对比度调整
   - 色彩饱和度
   - 模糊效果

2. **SIMD 优化**：
   - 使用 SIMD 指令并行处理多个像素
   - 进一步提升性能

3. **多线程处理**：
   - 使用 Web Workers
   - 分块并行处理大图片

---

**创建日期**：2025年12月9日  
**示例版本**：v1.0

